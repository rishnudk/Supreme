<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css">



  <!-- <style>
body {
    font-family: 'Roboto', sans-serif;
    background-color: #f8f9fa; /* Light background for the body */
}

.header {
    padding: 1.5rem 2rem; /* Increased padding */
    background-color: #ffffff; /* White header background */
    border-bottom: 1px solid #e5e7eb; /* Subtle border */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Low shadow for depth */
}

.header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: #1f2937; /* Dark text color */
}

.header form {
    display: flex;
    gap: 0.75rem;
    align-items: center;
}

.header input[type="text"] {
    padding: 0.5rem 1rem;
    border: 1px solid #d1d5db; /* Light border color */
    border-radius: 0.375rem; /* Rounded corners */
    font-size: 0.875rem;
    width: 300px; /* Fixed width */
    transition: border-color 0.15s ease-in-out;
}

.header input[type="text"]:focus {
    outline: none; /* Remove outline */
    border-color: #3b82f6; /* Border color on focus */
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25); /* Focus shadow */
}

.header button[type="submit"] {
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    background-color: #3b82f6; /* Blue background */
    color: white; /* White text color */
    border: 1px solid transparent;
    transition: all 0.15s ease-in-out; /* Smooth transition */
}

.header button[type="submit"]:hover {
    background-color: #2563eb; /* Darker blue on hover */
}

.status-active {
    background-color: #d1fae5; /* Light green background */
    color: #15803d; /* Dark green text */
    font-weight: bold; /* Bold text */
    padding: 0.25rem 0.5rem; /* Padding for status */
    border-radius: 0.375rem; /* Rounded corners for status */
}

.status-inactive {
    background-color: #fee2e2; /* Light red background */
    color: #991b1b; /* Dark red text */
    font-weight: bold;
    padding: 0.25rem 0.5rem; /* Padding for status */
    border-radius: 0.375rem; /* Rounded corners for status */
}

.actions button {
    margin: 0 5px;
    border: 1px solid #d1d5db; /* Light border */
    border-radius: 0.375rem; /* Rounded corners */
    padding: 0.25rem 0.5rem; /* Padding for action buttons */
}

.pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    gap: 12px;
}

.pagination-container a {
    text-decoration: none;
    color: #2563eb; /* Blue text for pagination links */
    padding: 8px 12px;
    border: 1px solid #e5e7eb; /* Light border */
    border-radius: 6px; /* Rounded corners */
    transition: all 0.2s ease;
    font-size: 14px; /* Font size */
    min-width: 60px; /* Minimum width */
    text-align: center; /* Centered text */
}

.pagination-container a:hover {
    background-color: #2563eb; /* Hover background color */
    color: white; /* White text on hover */
}

.pagination-text {
    color: #4b5563; /* Dark grey for pagination text */
    font-size: 14px; /* Font size */
}

/* Optional: Disabled state for pagination links */
.pagination-container a.disabled {
    color: #9ca3af; /* Light grey */
    pointer-events: none; /* Disable pointer events */
    border-color: #e5e7eb; /* Light border */
}

.table {
    background-color: white; /* White table background */
    border-radius: 8px; /* Rounded corners */
    overflow: hidden; /* Ensure no overflow */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Table shadow */
}

.table th, .table td {
    vertical-align: middle; /* Middle alignment */
    padding: 12px; /* Padding for cells */
}
.user{
    display: none;
}
.clear {
    background-color: #f44336; /* Red background */
    color: white;             /* White text */
    border: none;             /* No border */
    border-radius: 4px;      /* Slightly rounded corners */
    padding: 10px 20px;      /* Padding around the text */
    font-size: 16px;         /* Font size */
    cursor: pointer;         /* Change cursor on hover */
    transition: background-color 0.3s; /* Smooth background transition */
}

.clear:hover {
    background-color: #d32f2f; /* Darker red on hover */
}

.clear:active {
    background-color: #b71c1c; /* Even darker red when active */
}
  </style> -->

<style>
  /* ðŸ“Œ Root Variables for 2025 Design */
:root {
    --primary: #1e88e5; /* Vibrant blue */
    --secondary: #ff4081; /* Secondary accent */
    --background: #f5f7fa; /* Light background */
    --card-bg: #ffffff; /* White card */
    --text: #212121; /* Dark text */
    --text-light: #757575; /* Lighter text */
    --error: #d32f2f; /* Red for errors */
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Modern shadow */
    --sidebar-width-closed: 0px;
    --sidebar-width-open: 250px; /* Match adminSidebar.css */
}

/* ðŸ“Œ Container Styling */
.container {
    margin-left: var(--sidebar-width-closed);
    padding: 2rem;
    min-height: 100vh;
    width: 80%; /* Centered with 80% width */
    max-width: 1200px; /* Consistent with other pages */
    margin-left: auto;
    margin-right: auto; /* Center the container */
    transition: all 0.3s ease-in-out;
}

/* Adjust container when sidebar is open */
#admin-sidebar.show ~ .container {
    margin-left: calc(var(--sidebar-width-open) + 10%); /* Adjust for 80% width */
    width: calc(80% - var(--sidebar-width-open));
}

/* ðŸ“Œ Header Section */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.header h2 {
    font-size: 2rem;
    font-weight: 600;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* ðŸ“Œ Search Form */
.header form {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.header input[type="text"] {
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    width: 250px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.header input[type="text"]:focus {
    border-color: var(--primary);
    box-shadow: 0 0 8px rgba(30, 136, 229, 0.2);
    outline: none;
}

.header button[type="submit"] {
    padding: 0.75rem 1.5rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
}

.header button[type="submit"]:hover {
    background: #1565c0;
}

.header .clear {
    padding: 0.75rem 1.5rem;
    background: #e0e0e0;
    color: var(--text);
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
}

.header .clear:hover {
    background: #bdbdbd;
}

/* ðŸ“Œ User Table */
.table {
    width: 100%;
    border-collapse: collapse;
    background: var(--card-bg);
    border-radius: 16px;
    box-shadow: var(--shadow);
    overflow: hidden;
}

.table thead th {
    background: var(--primary);
    color: white;
    padding: 1rem;
    font-size: 1.1rem;
    font-weight: 500;
    text-align: left;
}

.table tbody tr {
    border-bottom: 1px solid #e0e0e0;
    transition: background 0.3s ease;
}

.table-hover tbody tr:hover {
    background: rgba(0, 0, 0, 0.05);
}

.table td {
    padding: 1rem;
    font-size: 1rem;
}

/* ðŸ“Œ Pagination Container */
.pagination-container {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 2rem;
}

.page-link {
    padding: 0.5rem 1rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    text-decoration: none;
    transition: background 0.3s ease;
}

.page-link:hover {
    background: #1565c0;
}

.page-link.active {
    background: #1565c0;
    font-weight: 600;
}

/* ðŸ“Œ Modal (Bootstrap Adjusted for 2025 Style) */
.modal.fade {
    display: none; /* Hidden by default, Bootstrap toggles it */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal-dialog {
    max-width: 600px;
    width: 90%;
    margin: 0 auto;
}

.modal-content {
    background: var(--card-bg);
    border-radius: 16px;
    box-shadow: var(--shadow);
    padding: 2rem;
    border: none;
}

.modal-header {
    border-bottom: none;
    padding: 0 0 1rem 0;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 1px;
    width: 100%;
    text-align: center;
}

.btn-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    color: var(--text);
    cursor: pointer;
    transition: color 0.3s ease;
}

.btn-close:hover {
    color: var(--error);
}

.modal-body {
    padding: 0;
}

.mb-3 {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    font-size: 1.1rem;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 0.5rem;
}

.form-control,
.form-select {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.form-control:focus,
.form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 8px rgba(30, 136, 229, 0.2);
    outline: none;
}

.modal-footer {
    border-top: none;
    padding: 1rem 0 0 0;
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.btn-secondary {
    padding: 0.75rem 1.5rem;
    background: #e0e0e0;
    color: var(--text);
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
}

.btn-secondary:hover {
    background: #bdbdbd;
}

.btn-primary {
    padding: 0.75rem 1.5rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
}

.btn-primary:hover {
    background: #1565c0;
}

/* ðŸ“Œ Responsive Adjustments */
@media (max-width: 768px) {
    #admin-sidebar.show ~ .container {
        margin-left: 250px;
        width: calc(80% - 250px);
    }

    .container {
        margin-left: 0;
        padding: 1rem;
        width: 100%;
    }

    .header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }

    .header h2 {
        font-size: 1.5rem;
    }

    .header form {
        width: 100%;
        max-width: 400px;
    }

    .table th,
    .table td {
        font-size: 0.9rem;
        padding: 0.75rem;
    }

    .modal-content {
        padding: 1.5rem;
    }
}

@media (max-width: 480px) {
    #admin-sidebar.show ~ .container {
        margin-left: 0;
        width: 100%;
    }

    .container {
        padding: 0.5rem;
    }

    .header h2 {
        font-size: 1.25rem;
    }

    .header input[type="text"] {
        width: 100%;
    }

    .header button {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
    }

    .table {
        font-size: 0.8rem;
    }

    .table th,
    .table td {
        padding: 0.5rem;
    }

    .pagination-container {
        flex-wrap: wrap;
    }

    .modal-content {
        padding: 1rem;
    }

    .modal-title {
        font-size: 1.25rem;
    }
}
</style>

</head>
<body>
    <%- include('../partials/adminSidebar') %>
  <div class="container my-5">
    <!-- Header and Search Bar -->

    <div class="header d-flex justify-content-between align-items-center">
      <h2>User Management</h2>
      <form action="/admin/user" method="GET">
        <input type="text" name="search" value="<%= search %>" placeholder="Search by email" />
        <button type="submit">Search</button>
        <button type="button" class="clear" onclick="clearSearch()">Clear</button>
      </form>
    </div>

    <!-- User Table -->
    <table class="table table-hover mt-4">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- Users will be dynamically populated here -->
      </tbody>
    </table>

  </div>

  <!-- Edit User Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editUserForm">
            <div class="mb-3">
              <label for="editName" class="form-label">Name</label>
              <input type="text" class="form-control" id="editName" required>
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editEmail" required>
            </div>
            <div class="mb-3">
              <label for="editRole" class="form-label">Role</label>
              <select class="form-select" id="editRole" required>
                <option value="Admin">Admin</option>
                <option value="Editor">Editor</option>
                <option value="Viewer">Viewer</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveChanges">Save Changes</button>
        </div>
      </div>
    </div>
  </div>




 

  <div class="pagination-container">
    <% for (let i = 1; i <= totalPages; i++) { %>
      <a href="/admin/user?page=<%= i %>&search=<%= search %>" 
         class="page-link <%= i === currentPage ? 'active' : '' %>">
        <%= i %>
      </a>
    <% } %>
  </div>
  <div id="user" style="display: none;" class="user">
    <%=users%>
      </div>




  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // Sample Data
    let users = document.getElementById('user').innerHTML;
    users = JSON.parse(users);
    console.log(users);

    let currentPage = 1;
    const usersPerPage = 3;

    // Render Users

    // function renderUsers() {
    //   const tbody = document.getElementById('userTableBody');
    //   tbody.innerHTML = '';
    //   users.forEach(user => {
    //     const row = `
    //       <tr>
    //         <td>${user.name}</td>
    //         <td>${user.email}</td>
    //         <td><span class="${user.status === 'Active' ? 'status-active' : 'status-inactive'}">${user.status}</span>  <div class="toast-body" id="toastMessage"></div></td>
    //         <td class="actions">
    //             <button 
    //       onclick="confirmAction('${user._id}', '${user.status}')"
    //       class="btn btn-sm ${user.status === 'Active' ? 'btn-danger' : 'btn-success'}"
    //     >
    //       ${user.status === 'Active' ? 'Block' : 'Unblock'}
    //     </button>
    //         </td>
    //       </tr>
    //     `;
    //     tbody.innerHTML += row;
    //   });
    // }


    function renderUsers() {
  const tbody = document.getElementById('userTableBody');
  tbody.innerHTML = '';
  console.log("Before Sorting:", JSON.stringify(users, null, 2)); 
  // Sort users by `_id` in descending order (newest first)
  users.sort((a, b) => b._id.localeCompare(a._id)); 
  console.log("After Sorting:", JSON.stringify(users, null, 2));


  users.forEach(user => {
    const row = `
      <tr>
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td><span class="${user.status === 'Active' ? 'status-active' : 'status-inactive'}">
          ${user.status}
        </span>  
        <div class="toast-body" id="toastMessage"></div></td>
        <td class="actions">
          <button 
            onclick="confirmAction('${user._id}', '${user.status}')"
            class="btn btn-sm ${user.status === 'Active' ? 'btn-danger' : 'btn-success'}"
          >
            ${user.status === 'Active' ? 'Block' : 'Unblock'}
          </button>
        </td>
      </tr>
    `;
    tbody.innerHTML += row;
  });
}







    // Open Edit Modal
    function openEditModal(id) {
      const user = users.find(u => u.id === id);
      document.getElementById('editName').value = user.name;
      document.getElementById('editEmail').value = user.email;
      document.getElementById('editRole').value = user.role;
      new bootstrap.Modal(document.getElementById('editUserModal')).show();
    }


    function confirmAction(userId, status) {
        const modalElement = document.getElementById('confirmModal');
  const confirmBtn = document.getElementById('confirmAction');
  const actionTextSpan = document.getElementById('actionText');
  
  const action = status === 'Active' ? 'block' : 'unblock';
  Swal.fire({
        title: `Are you sure you want to ${action} this user?`,
        text: `The user will be ${action}ed and this action can be reverted.`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: action === 'block' ? '#d33' : '#3085d6',
        cancelButtonColor: '#6c757d',
        confirmButtonText: `Yes, ${action} user!`
    }).then(async (result) => {
        if (result.isConfirmed) {
    try {
     
      const response = await fetch(`/admin/user/status/${userId}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) {
        throw new Error('Failed to update status');
      }

      const result = await response.json();
      

      const user = users.find(u => u._id === userId);
      if (user) {
        user.status = result.status;
      }
      
      renderUsers();  
  
  showToast('Success', 'User status updated successfully');


      
    } catch (error) {
      console.error('Error:', error);
      showToast('Error', 'Failed to update user status');
    }
  };
}
    )}

function showToast(title, message) {

  const toast = new bootstrap.Toast(document.getElementById('statusToast'));
  document.getElementById('toastTitle').textContent = title;
  document.getElementById('toastMessage').textContent = message;
  toast.show();
}


    renderUsers();
    function clearSearch() {
    window.location.href = '/admin/user'; 
  }
  </script>


</body>
</html>