<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/css/log.css">
	<title>Document</title>
	<style>
		/* Modal Background */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Dark overlay */
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Modal Content Box */
.modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    width: 300px;
}

/* Close Button */
.close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
}
#verifyOtpForm {
    display: none; /* Initially hidden */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
    border-radius: 10px;
    z-index: 1000;
}


	</style>
</head>

<body>

	<section>
		<div id="cover">
			<img draggable="false" src="https://i.pinimg.com/736x/cb/20/60/cb206047101b354898b36e564a33cc65.jpg"
				alt="logo" id="icon" width="40" style="mix-blend-mode: color-dodge;">

			<input type="radio" name="controler" id="slide1" hidden checked>
			<input type="radio" name="controler" id="slide2" hidden>
			<input type="radio" name="controler" id="slide3" hidden>
			<input type="radio" name="controler" id="slide4" hidden>

			<div id="sliderContainer">
				<div id="model1">
					<h1>"NoName has become an essential tool in our workflow, helping us create stunning websites
						effortlessly."</h1>
					<span class="about">
						<div class="controlLabels">
							<label for="slide4" class="before">←</label>
							<label for="slide2" class="after">→</label>
						</div>
					</span>
					<img draggable="false" src="https://i.pinimg.com/236x/70/9e/57/709e574de051258a80745a745163acfb.jpg"
						alt="model1" id="imgModel1" width="110" height="150" style="object-fit: cover">
				</div>
				<div id="model2">
					<h1>"Since incorporating NoName into our process, every project feels more streamlined and
						efficient."</h1>
					<span class="about">
						<div class="controlLabels">
							<label for="slide1" class="before">←</label>
							<label for="slide3" class="after">→</label>
						</div>
					</span>
					<img draggable="false" src="https://i.pinimg.com/736x/a3/e3/11/a3e311abe61ffe88653cec16b45f051f.jpg"
						alt="model2" id="imgModel2" width="110" height="150" style="object-fit: cover">
				</div>
				<div id="model3">
					<h1>"We rely on NoName for every new design, and it’s made a huge difference in our productivity."
					</h1>
					<span class="about">
						<div class="controlLabels">
							<label for="slide2" class="before">←</label>
							<label for="slide4" class="after">→</label>
						</div>
					</span>
					<img draggable="false" src="https://i.pinimg.com/736x/c8/5e/a5/c85ea5f0a0cc23c1f8b21ca769c40a57.jpg"
						alt="model3" id="imgModel3" width="110" height="150" style="object-fit: cover">
				</div>
				<div id="model4">
					<h1>"NoName is the backbone of our design process, and we couldn’t imagine working without it."</h1>
					<span class="about">
						<div class="controlLabels">
							<label for="slide3" class="before">←</label>
							<label for="slide1" class="after">→</label>
						</div>
					</span>
					<img draggable="false" src="https://i.pinimg.com/236x/4e/79/9a/4e799a1440f4d908af1b8cd3f69505fb.jpg"
						alt="model4" id="imgModel4" width="110" height="150" style="object-fit: cover">
				</div>
			</div>
		</div>
		<div id="createAccountForm">
			<h1>Create an account</h1>
			<small>"Where Style Meets Comfort – Sign Up & Start Shopping!".</small>
			<form id="createAccountForm" action="/user/signup" method="POST">
				<input type="text" name="name" id="name" placeholder="Name" required>
				<input type="email" name="email" id="email" placeholder="Email" required>
				<input type="password" name="password" id="password" placeholder="Password" required>
				<input type="password" name="confirmPassword" id="confirmPassword" placeholder="Confirm Password"
					required>
				<input type="text" name="phone" id="phone" placeholder="Phone" required>
				<input type="text" name="referral" id="referral" placeholder="Referral Code (Optional)">
				<button type="submit" id="createAccount">Create account</button>
				
			</form>
			<button type="button" id="googleLogin">
				<img draggable="false" src="https://cdn-icons-png.flaticon.com/128/300/300221.png" alt="Google"
					width="14">
				Sign up with Google</button>

			<span class="login">
				<p>Already have an account? </p><a href="/user/login" id="login">Log in</a>
			</span>
		</div>


		<!-- OTP Modal -->
		<div id="otpModal" class="modal">
			<div class="modal-content">
				<span class="close">&times;</span> <!-- Close button -->
				<h2>Enter OTP</h2>
				<p>An OTP has been sent to your email.</p>
				<input type="text" id="otpInput" placeholder="Enter OTP" required>
				<button type="button" id="verifyOtp">Verify OTP</button>
				<button type="button" id="resendOtp" onclick="resendOTP()">Resend OTP</button>
			</div>
		</div>




		
	</section>




<script>
    // Define CSS for the modal (unchanged)
    const modalStyle = document.createElement('style');
    modalStyle.textContent = `
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 5px; position: relative; }
        .close { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover, .close:focus { color: black; text-decoration: none; }
        #otpInput { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        #verifyOtp { width: 100%; padding: 12px; margin: 10px 0; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        #verifyOtp:disabled { background-color: #cccccc; cursor: not-allowed; }
    `;
    document.head.appendChild(modalStyle);

    // Form submission
    document.getElementById("createAccountForm").addEventListener("submit", async function (event) {
        event.preventDefault();

        let isValid = true;

        // Get form values
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const confirmPassword = document.getElementById("confirmPassword").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const referral = document.getElementById("referral").value.trim();

        // Store form data
        window.formData = { name, email, password, phone, referral };

        // Validation patterns
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
        const phonePattern = /^[0-9]{10}$/;

        // Clear previous errors
        document.querySelectorAll(".error").forEach(el => el.remove());

        function showError(input, message) {
            const error = document.createElement("small");
            error.classList.add("error");
            error.style.color = "red";
            error.innerText = message;
            input.parentNode.insertBefore(error, input.nextSibling);
        }

        // Validate inputs
        if (!name) { showError(document.getElementById("name"), "Name cannot be empty."); isValid = false; }
        if (!emailPattern.test(email)) { showError(document.getElementById("email"), "Enter a valid email."); isValid = false; }
        if (!passwordPattern.test(password)) { showError(document.getElementById("password"), "Password must be at least 8 characters, include a letter and a number."); isValid = false; }
        if (password !== confirmPassword) { showError(document.getElementById("confirmPassword"), "Passwords do not match."); isValid = false; }
        if (!phonePattern.test(phone)) { showError(document.getElementById("phone"), "Enter a valid 10-digit phone number."); isValid = false; }

        if (!isValid) return;

        const submitButton = document.getElementById("createAccount");
        submitButton.disabled = true;
        submitButton.innerText = "Sending OTP...";

        try {
            const response = await fetch("/user/send-signup-otp", { // Changed to /user
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email })
            });

            const data = await response.json();
            if (response.ok) {
                document.getElementById("otpModal").style.display = "block";
                document.getElementById("otpInput").focus();
            } else {
                alert(data.error || "Failed to send OTP");
            }
        } catch (error) {
            console.error("Error sending OTP:", error);
            alert("Error sending OTP");
        }

        submitButton.disabled = false;
        submitButton.innerText = "Create Account";
    });

    // Close modal
    document.querySelector(".close").addEventListener("click", function() {
        document.getElementById("otpModal").style.display = "none";
    });
    window.addEventListener("click", function(event) {
        const modal = document.getElementById("otpModal");
        if (event.target === modal) modal.style.display = "none";
    });

    // OTP Verification
    document.getElementById("verifyOtp").addEventListener("click", async function () {
        const otp = document.getElementById("otpInput").value.trim();
        const { email, name, password, phone, referral } = window.formData;

        if (!otp) {
            alert("Please enter the OTP.");
            return;
        }

        const verifyButton = document.getElementById("verifyOtp");
        verifyButton.disabled = true;
        verifyButton.innerText = "Verifying...";

        try {
            const otpResponse = await fetch("/user/verify-signup-otp", { 
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, name, password, phone, otp, referral })
            });

            const otpData = await otpResponse.json();
            if (otpResponse.ok) {
                alert(otpData.message);
                window.location.href = otpData.redirect;
            } else {
                alert(otpData.error || "Invalid OTP");
            }
        } catch (error) {
            console.error("Error during verification:", error);
            alert("Error during verification process");
        }

        verifyButton.disabled = false;
        verifyButton.innerText = "Verify OTP";
    });
</script>

</body>

</html>